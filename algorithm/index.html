<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<HTML>
<HEAD>
  <TITLE>Maestro: algorithm</TITLE> 

  <link rel="stylesheet" type="text/css" href="../hydro.css">
  <META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=ISO-8859-1">

</HEAD> 

<body id="algorithm">

<div id="container">

<!-- HEADER .............................................................. -->
<!-- to do highlighting:

http://hicksdesign.co.uk/journal/highlighting-current-page-with-css

http://www.richnetapps.com/automatically_highlight_current_page_in/

-->


<div id="header">
  <h1>Maestro</h1><br>
  <h3>An adaptive low-Mach number hydrodynamics code for stratified astrophysical flows</h3>
</div>

<div id="subhead">
  <h2><a href="/MAESTRO/index.html" id="intronav">intro</a></h2> &bull;
  <h2><a href="/MAESTRO/background" id="backgroundnav">background</a></h2> &bull;
  <h2><a href="/MAESTRO/algorithm" id="algonav">algorithm</a></h2> &bull;
  <h2><a href="/MAESTRO/science" id="sciencenav">science</a></h2> &bull;
  <h2><a href="/MAESTRO/papers" id="papersnav">papers</a></h2>
 &nbsp;|&nbsp;
  <h2><a href="/MAESTRO/download" id="dlnav">download</a></h2> &bull;
  <h2><a href="/MAESTRO/help/" id="helpnav">get help</a></h2>
</div>




<!-- MAIN ................................................................ -->
<div id="main">



<p><h2>&lowast; Solution methodology</h2>

<p>The low Mach number formulation approximates flows in hydrostatic
equilibrium, filtering out the sound waves.  The fluid state is
decomposed into a 1D, hydrostatic base state and a perturbational
Cartesian state.  A constraint on the divergence of the velocity field
captures the compressibility due to background stratification and
local heating/diffusion sources.  The resulting system takes 
the form of hyperbolic PDEs for mass, momentum, and enthalpy
(energy) conservation, and the elliptic constraint on thevelocity.
The algorithm utilizes a second-order accurate
approximate projection method, developed first for incompressible
flows.  Fluid quantities are advected using an unsplit Godunov method,
with reactions incorporated via operator splitting.  The provisional
velocities are then projected onto the space that satisfies the
divergence constraint.  The projections involve elliptic solves,
computed using a multigrid algorithm.  Adaptive mesh refinement is
used to achieve high spatial resolution.  


<p><h2>&lowast; Code &amp; parallelism</h2>

<p>Maestro is written primarily in Fortran 95 and is parallelized
using MPI and OpenMP.  The adaptivity and message passing is managed
by the <a href="https://ccse.lbl.gov/BoxLib/">BoxLib</a> library.  Distribution of grid patches to nodes using
MPI provides a natural coarse-grained approach to distributing the
computational work, while threading of loops over grids using OpenMP
provides effective fine-grained parallelization.

<p>The code is highly portable, and regularly runs on
the titan at OLCF, hopper and edison at NERSC, and blue waters at NCSA
(at the low end, it has even run on a Raspberry Pi).  The only requirements
are a Fortran and C compiler (the GCC suite is best).  If you wish to
run in parallel, then an MPI library is needed.

<p>Parallel performance depends on having enough work on each
processor to balance the communication costs.  The figure below shows
strong scaling for 2 different problem sizes for an X-ray burst
simulation on the OLCF titan machine.

<p class="center"><img src="./titan_xrb_scaling.png">

<p>For each problem size, a 48<sup>3</sup> grid domain decomposition
was used.  Runs were done with 2 grids / MPI task, 1 grid per MPI
task, and then 1 grid per MPI task with 4, 8, and 16 OpenMP threads.
For reference, a titan node has 16 cpus arranged into 8 compute units,
but two cpus share a floating point unit on each compute unit.  These 
are distributed across 2 physics sockets.  For
this strong scaling test, we see excellent scaling so long as we stay
on a single socket.  NUMA issues cause less ideal scaling when all
cores on a node are used via OpenMP.

</div>  <!-- main -->


<!-- FOOTER .............................................................. -->
<div id="footer">
   <a href="/MAESTRO/acknowledgements/">acknowledgements</a>
</div>



</div>

</BODY>
</HTML>



