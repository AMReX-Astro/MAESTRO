\begin{lstlisting}[language=bash,mathescape=false]
  #!/bin/bash
  # Compile ALL mesa (v 4088) directories

  function check_okay {
     if [ $? -ne 0 ]
     then
        exit 1
     fi
  }
  function do_one {
     for dir in "$@"
     do
       cd $1
       check_okay
       echo
       echo "Begin: " $1
       echo
       ./clean
       check_okay
       ./mk
       check_okay
       ./export
       check_okay
       echo "%%%%%%%%%%%%%%%%%%%%%%%%"
       echo " SUCCESS: " $1
       echo "%%%%%%%%%%%%%%%%%%%%%%%%"
       cd ..
     done
  }
  do_one adipls alert atm chem colors const diffusion eos
  do_one interp_1d interp_2d ionization kap mlt mtx net neu
  do_ont num rates reaclib screen star
  if [ ! -e utils/mk ]; then
     cp star/mk utils/
  fi
  do_one utils weaklib
  echo "%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%"
  echo "   Successfully Compiled All Modules"
  echo "%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%"
\end{lstlisting}

