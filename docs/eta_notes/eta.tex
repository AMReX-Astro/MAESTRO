We carry around three different 1D radial quantities: $\etarhoec$
(edge-centered), $\etarhocc$ (cell-centered), and $\divetarho$
(cell-centered).  These notes discuss when each of these is used, and
how they are computed, in both plane-parallel and spherical.

%-----------------------------------------------------------------------------
% flow chart
%-----------------------------------------------------------------------------
\section{$\eta$ Flow Chart}
\begin{enumerate}
\item Enter {\tt advance} with $[\etarhoec, \etarhocc, \divetarho]^{n-\half}$.
\item Call {\tt make\_w0}.  The spherical version uses uses $\etarhoec$ and $\etarhocc$.
\item Call {\tt density\_advance}.  The plane-parallel version computes $\etarhoflux$.
\item Call {\tt correct\_base}, which uses $\divetarho$.
\item Compute $[\etarhoec, \etarhocc, \divetarho]^{n+\half,*}$.
\item Call {\tt make\_psi}.  The plane-parallel version uses $\etarhocc$.
\item Call {\tt make\_w0}.  The spherical version uses uses $\etarhoec$ and $\etarhocc$.
\item Call {\tt density\_advance}.  The plane-parallel version computes $\etarhoflux$.
\item Call {\tt correct\_base}, which uses $\divetarho$.
\item Compute $[\etarhoec, \etarhocc, \divetarho]^{n+\half}$.
\item Call {\tt make\_psi}.  The plane-parallel version uses $\etarhocc$.
\end{enumerate}

\MarginPar{I don't think that this is accurate anymore -- we don't lag $\eta$}

%-----------------------------------------------------------------------------
% computing
%-----------------------------------------------------------------------------
\section{Computing $\etarhoec, \etarhocc$, and $\divetarho$}
This is done in {\tt make\_eta.f90}.

\subsection{Plane-Parallel}
We first compute a radial edge-centered multifab, $\eta_{\rho}^{\rm flux}$, using
\begin{equation}
\eta_{\rho,\ib+\half\eb_r}^{\rm flux} = \left[\left(\Ubt_{\ib+\half\eb_r}^{n+\half}\cdot\eb_r\right) + w_{0,r+\half}^{n+\half}\right] \rho_{\ib+\half\eb_r}^{n+\half} - w_{0,r+\half}^{n+\half}\rho_{0,r+\half}^{n+\half, {\rm pred}}
\end{equation}
$\etarhoec$ is the edge-centered ``average'' value of $\eta_{\rho}^{\rm flux}$,
\begin{equation}
\eta_{\rho,r+\half}^{\rm ec} = \overline{\eta_{\rho,\ib+\half\eb_r}^{\rm flux}}
\end{equation}
$\etarhocc$ is a cell-centered average of $\etarhoec$,
\begin{equation}
\eta_{\rho,r}^{\rm cc} = \frac{\eta_{\rho,r+\half}^{\rm ec} + \eta_{\rho,r-\half}^{\rm ec}}{2}.
\end{equation}
$\divetarho$ is the cell-centered divergence of $\etarhoec$,
\begin{equation}
\left[\divetarho\right]_r = \frac{\eta_{\rho,r+\half}^{\rm ec} - \eta_{\rho,r-\half}^{\rm ec}}{\Delta r}.
\end{equation}

\subsection{Spherical}
First, construct $\eta_{\rho}^{\rm cart} =
[\rho'(\Ubt\cdot\eb_r)]^{n+\half}$ using:
\begin{equation}
\left[\frac{\rho^n+\rho^{n+1}}{2}-\left(\frac{\rho_0^n+\rho_0^{n+1}}{2}\right)^{\rm cart}\right] \sum_d\left(\frac{\Ubt_{\ib+\half\eb_d}^{n+\half}\cdot\eb_d+\Ubt_{\ib-\half\eb_d}^{n+\half}\cdot\eb_d}{2}\right)n_d.
\end{equation}
Then, $\etarhocc$ is the cell-centered average of $\eta_{\rho}^{\rm cart}$,
\begin{equation}
\etarhocc = \overline{\eta_{\rho}^{\rm cart}}.
\end{equation}
On interior faces, $\etarhoec$ is the average of $\etarhocc$,
\begin{equation}
\eta_{\rho,r-\half}^{\rm ec} = \frac{\eta_{\rho,r-1}^{\rm cc} + \eta_{\rho,r}^{\rm cc}}{2}.
\end{equation}
At the upper and lower boundaries, we use
\begin{eqnarray}
\eta_{\rho,-\half}^{\rm ec} &=& 0, \\
\eta_{\rho,{\rm nr}-\half}^{\rm ec} &=& \eta_{\rho,{\rm nr}-1}^{\rm cc}.
\end{eqnarray}
$\divetarho$ is constructed from the cell-centered average of
$\rho'^{n+1} = \rho^{n+1} - \rho_0^{n+1}$ as
\begin{equation}
\divetarho = -\overline{\rho'^{n+1}}/\Delta t
\end{equation}

%-----------------------------------------------------------------------------
% etarho_ec
%-----------------------------------------------------------------------------
\section{Using $\etarhoec$}
\subsection{Plane-Parallel}
NOT USED.

\subsection{Spherical}
In {\tt make\_w0}, $\etarhoec$ is used in the construction of the RHS
for the $\delta w_0$ equation.

%-----------------------------------------------------------------------------
% etarho_cc
%-----------------------------------------------------------------------------
\section{Using $\etarhocc$}
\subsection{Plane-Parallel}
In {\tt make\_psi}, $\psi = \etarhocc g$.

\subsection{Spherical}
In {\tt make\_w0}, $\etarhocc$ is used in the construction of the RHS
for the $\delta w_0$ equation.

%-----------------------------------------------------------------------------
% div etarho
%-----------------------------------------------------------------------------
\section{Using $\divetarho$}
\subsection{Plane-Parallel}
In {\tt correct\_base}, $\rho_0^{n+1} = \rho_0^{n+1} - \Delta t \divetarho$.

\subsection{Spherical}
In {\tt correct\_base}, $\rho_0^{n+1} = \rho_0^{n+1} - \Delta t \divetarho$. \\

